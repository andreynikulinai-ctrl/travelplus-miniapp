# Travel+ Mini App — чек-лист по порядку

Делай шаги по порядку и отмечай галочками.

---

## 1. Локальная проверка (отправка заявки)

Чтобы форма отправлялась **локально**, нужно запустить оба сервера.

- [ ] **1.1** В первом терминале — бэкенд.  
  - Если открыт **корень проекта** (travelplus-miniapp): `cd backend && node server.js`  
  - Если открыта папка **frontend**: `cd ../backend && node server.js`  
  Должно появиться: «Backend ready on http://localhost:3001».
- [ ] **1.2** Во втором терминале — фронтенд: `cd frontend && npm run dev`, открыть http://localhost:5173
- [ ] **1.3** Проверить каталог, фильтр по категориям, кнопку «Узнать цену».
- [ ] **1.4** Выбрать товары → кнопка «Выбрано» → модалка → «Запросить КП» → форма заявки.
- [ ] **1.5** Заполнить форму и отправить — должно появиться «Заявка отправлена!» и сообщение в Telegram.

---

## 2. Git и репозиторий

- [ ] **2.1** `git status` — убедиться, что нет лишних файлов в коммите
- [ ] **2.2** Закоммитить изменения:  
  `git add . && git commit -m "fix: full Telegram send logic, checklist"`
- [ ] **2.3** Запушить: `git push` (нужен интернет и доступ к GitHub)

---

## 3. Деплой на Vercel

- [ ] **3.1** Зайти на [vercel.com](https://vercel.com) → проект (или создать новый из репозитория)
- [ ] **3.2** **Root Directory:** оставить пустым (корень репо = корень проекта)
- [ ] **3.3** Build Command и Output Directory уже заданы в `vercel.json` — не переопределять
- [ ] **3.4** Сохранить и задеплоить (Deploy)

---

## 4. Переменные окружения в Vercel

- [ ] **4.1** В проекте: **Settings → Environment Variables**
- [ ] **4.2** Добавить:
  - `TELEGRAM_BOT_TOKEN` — токен бота от @BotFather
  - `TELEGRAM_CHAT_ID` — ID чата/группы, куда слать заявки
- [ ] **4.3** Выбрать окружения: Production (и при необходимости Preview)
- [ ] **4.4** Сохранить и **передеплоить** проект (Redeploy), чтобы переменные подхватились

---

## 5. Security / доступ к API

- [ ] **5.1** **Settings → Security**
- [ ] **5.2** Если включён **Vercel Authentication** или **Security Checkpoint** — либо отключить, либо добавить исключение для пути `/api/*`, чтобы `/api/send` был доступен без проверки браузера (для Telegram Mini App)

---

## 6. Проверка на проде

- [ ] **6.1** Открыть продовый URL (например `https://твой-проект.vercel.app`)
- [ ] **6.2** Проверить каталог и выбор товаров
- [ ] **6.3** Отправить тестовую заявку из формы
- [ ] **6.4** Убедиться, что в Telegram пришло сообщение с данными заявки
- [ ] **6.5** Если Mini App открывается из Telegram — проверить отправку заявки из него

---

## 7. Если что-то не работает

| Проблема | Что проверить |
|----------|----------------|
| 404 на `/api/send` | Root Directory = корень репо; в корне есть папка `api/` и файл `api/send.ts` |
| 500 «Missing TELEGRAM_BOT_TOKEN» | Добавлена переменная `TELEGRAM_BOT_TOKEN` в Vercel и сделан Redeploy |
| 500 «Missing TELEGRAM_CHAT_ID» | Добавлена переменная `TELEGRAM_CHAT_ID` в Vercel и сделан Redeploy |
| Заявка не приходит в Telegram | Проверить токен бота и chat_id; посмотреть логи функции в Vercel (Functions → api/send → Logs) |
| CORS / блок в браузере | В `api/send.ts` уже стоят заголовки CORS; если запрос с другого домена — проверить, что в Vercel нет лишних ограничений по домену |
| Security Checkpoint перехватывает | В Vercel: Settings → Security → исключить `/api/*` или отключить проверку для API |

---

Готово. Выполняй шаги по порядку и отмечай пункты.

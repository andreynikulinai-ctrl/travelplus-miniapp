# Travel+ Mini App — описание проекта для юридической проверки

Ниже — техническое и процессное описание мини‑приложения «Travel+ Mini App»: где что находится в репозитории, какие данные обрабатываются, как они передаются, к чему подключается система и где потенциально происходит хранение.

---

## 1) Назначение и функциональность

**Цель проекта:** показать каталог товаров Travel+ (оснащение гостиниц/отелей/SPA) и дать пользователю возможность **отправить заявку на коммерческое предложение (КП)**.

**Ключевые функции:**
- **Каталог товаров**: список товаров, категории, карточки.
- **Выбор товаров**: пользователь добавляет товары в «Выбрано».
- **Форма заявки (КП)**: пользователь вводит контактные данные и отправляет заявку.
- **Политика конфиденциальности**: отдельная страница `/privacy`.
- **Интеграция с Telegram**:
  - отправка заявок в Telegram (в чат/группу);
  - (опционально) публикация поста в канал с кнопкой Web App «Каталог».

---

## 2) Состав системы (что развернуто в продакшене)

### 2.1. Frontend (клиентская часть)
- **Технологии:** Vite + React + TypeScript + Tailwind CSS.
- **Развертывание:** статические файлы (SPA) на Vercel.
- **Точка входа:** `frontend/index.html`, `frontend/src/main.tsx`.
- **Маршруты:**
  - `GET /` → SPA (основной экран каталога).
  - `GET /privacy` → страница политики конфиденциальности.

### 2.2. API (serverless-функции на Vercel)

В продакшене API реализовано как **Vercel Serverless Functions** в папке `api/` (в корне репозитория).

Доступные endpoints:
- **`/api/send`** (файл `api/send.ts`): приём заявки с фронтенда и пересылка в Telegram‑чат/группу через Telegram Bot API.
- **`/api/post-channel-message`** (файл `api/post-channel-message.ts`): однократная отправка поста в Telegram‑канал с кнопкой Web App «Каталог».

---

## 3) Структура репозитория (где что лежит)

Корень репозитория: `travelplus-miniapp/`

### 3.1. `frontend/` (клиентское приложение)
- **`frontend/index.html`**
  - подключает SPA;
  - подключает внешний скрипт Telegram Web App: `https://telegram.org/js/telegram-web-app.js` (загрузка из домена Telegram);
  - подгружает шрифт Akony из `/fonts/akony-bold.otf`.
- **`frontend/src/main.tsx`**: роутинг (React Router), маршруты `/` и `/privacy`.
- **`frontend/src/App.tsx`**: основной экран каталога, фильтр категорий, модалки «Выбрано» и форма заявки.
- **`frontend/src/pages/Privacy.tsx`**: страница политики конфиденциальности (текст).
- **`frontend/src/components/`**
  - `SelectedModal.tsx`: список выбранных товаров и кнопка «Запросить КП».
  - `OrderForm.tsx`: форма ввода персональных данных и отправка заявки.
  - `ProductCard.tsx`: карточка товара (в текущем UI основной экран использует встроенную разметку в `App.tsx`; файл `ProductCard.tsx` используется на странице `Catalog.tsx`).
- **`frontend/src/data/products.ts`**: мок‑данные каталога (категории + товары).
- **`frontend/src/types/product.ts`**: типы `Product`/`Category`.
- **`frontend/src/store/selectedStore.ts`**: Zustand‑хранилище выбранных товаров (в памяти).
- **`frontend/src/index.css`**: стили + импорт Google Fonts (Golos Text) с `https://fonts.googleapis.com/...`.
- **`frontend/public/`**: статические файлы (картинки товаров, иконки, шрифты).
  - `public/products/` — изображения товаров (сейчас фактически загружено `18709.jpg`, остальные пути зарезервированы под будущие файлы).
  - `public/fonts/akony-bold.otf` — локальный шрифт.
  - `public/slippers-icon.png` — иконка для заглушки «Фото скоро появится».
  - `public/placeholder.svg` — fallback‑картинка при ошибке загрузки изображения.

### 3.2. `api/` (серверные endpoints на Vercel)
- **`api/send.ts`**: принимает JSON с данными заявки и отправляет сообщение в Telegram через Bot API `sendMessage`.
- **`api/post-channel-message.ts`**: отправляет в канал сообщение с inline‑кнопкой типа Web App (открывает URL приложения).

### 3.3. `backend/` (локальная разработка API)
Используется **только для локального запуска** (dev), чтобы отправлять заявки в Telegram без Vercel.
- **`backend/server.js`**: Express‑сервер на `http://localhost:3001`, endpoints `/api/send` и `/api/orders`.
- **`backend/package.json`**: зависимости `express`, `cors`, `node-fetch`.

Внимание: в `backend/server.js` присутствуют значения токена/чата по умолчанию (fallback). Это удобно для локального теста, но **не рекомендуется** хранить реальные токены/ID в репозитории.

### 3.4. Файлы конфигурации и инструкции
- **`vercel.json`**: правила сборки/вывода, rewrites для SPA, заголовки для `/api/*`, регистрация serverless‑функций.
- **`VERCEL_НАСТРОЙКА.md`**: инструкция по настройке Vercel (Root Directory, env vars, security).
- **`ПОСТ_В_КАНАЛ_С_КНОПКОЙ_КАТАЛОГ.md`** и **`КАК_ОТКРЫТЬ_МИНИ_АПП_ИЗ_КАНАЛА.md`**: инструкции по размещению ссылки/кнопки в Telegram‑канале.

---

## 4) Какие данные обрабатываются (что именно собираем)

### 4.1. Данные, которые вводит пользователь в форме заявки
Форма находится во фронтенде: `frontend/src/components/OrderForm.tsx`.

Собираемые поля:
- **Имя** (`name`) — обязательное поле.
- **Телефон** (`phone`) — обязательное поле.
- **Email** (`email`) — обязательное поле.
- **Компания** (`company`) — необязательное поле.
- **Комментарий** (`comment`) — необязательное поле.
- **Предпочтительный способ связи** (`contactMethod`) — выбор из: `telegram | email | phone`.
- **Согласие на обработку персональных данных** (`agreedToPolicy`) — чекбокс, без него отправка блокируется.

### 4.2. Данные о выборе товаров (не персональные, но часть заявки)
- **Список выбранных товаров** (`items`) из Zustand‑хранилища (`frontend/src/store/selectedStore.ts`).
- Каждый товар содержит поля из типа `Product` (`id`, `name`, `description`, `category`, `images`, `packaging`, и т.д.).

### 4.3. Какие данные НЕ собираются (в текущей реализации)
На данный момент код фронтенда:
- не запрашивает логин/пароль;
- не собирает паспортные данные/адрес доставки/платёжные данные;
- не использует стороннюю аналитику (типа GA/Meta Pixel) в коде;
- не сохраняет введённые данные в базе данных проекта (БД в проекте отсутствует).

---

## 5) Как данные используются и куда отправляются (потоки данных)

### 5.1. Поток «Пользователь отправляет заявку»
1) Пользователь выбирает товары в UI.
2) Нажимает «Выбрано» → «Запросить КП».
3) Заполняет форму и подтверждает согласие.
4) Фронтенд отправляет запрос:
   - **локально (DEV):** `POST http://127.0.0.1:3001/api/send`
   - **в продакшене:** `POST /api/send` (на домене Vercel)

5) Endpoint `/api/send` (Vercel) формирует текст сообщения и делает запрос к Telegram Bot API:
   - `POST https://api.telegram.org/bot<TELEGRAM_BOT_TOKEN>/sendMessage`
   - payload содержит:
     - `chat_id = TELEGRAM_CHAT_ID`
     - `text = сформированный текст заявки`

6) В результате:
   - сообщение с заявкой появляется в Telegram‑чате/группе (куда указывает `TELEGRAM_CHAT_ID`);
   - фронтенд показывает пользователю сообщение об успехе/ошибке.

**Какая информация уходит в Telegram (как текст):**
- имя, телефон, email;
- (если указано) компания;
- список выбранных товаров (в текущей реализации отправляются названия товаров);
- выбранный способ связи;
- (если указано) комментарий.

### 5.2. Поток «Публикация поста в канал с кнопкой Web App»
Endpoint: `GET /api/post-channel-message?key=...` (Vercel).

Назначение: администратор один раз вызывает endpoint, и бот публикует в канал пост с кнопкой **«Каталог»**, которая открывает Web App по URL.

Данные:
- персональные данные пользователей не обрабатываются;
- передаются служебные данные (ID канала и URL приложения) в Telegram Bot API `sendMessage`.

Защита:
- используется query‑параметр `key`, который сравнивается с переменной окружения `POST_CHANNEL_SECRET`.

---

## 6) Где данные хранятся (хранение/логирование)

### 6.1. Внутри приложения (проект Travel+ Mini App)
В текущей реализации **нет собственной базы данных** и нет серверного хранилища заявок.

Хранение на стороне фронтенда:
- выбранные товары (`items`) хранятся в Zustand **только в памяти** браузера/вебвью (без персистенции в LocalStorage — в текущем коде).

### 6.2. На стороне Telegram (внешняя система)
После отправки заявки:
- данные заявки становятся **сообщением в Telegram‑чате/группе** (третья сторона — Telegram);
- дальнейшее хранение/обработка определяется политиками Telegram и настройками чата/аккаунтов.

### 6.3. На стороне Vercel (внешняя система)
- Vercel хранит **переменные окружения** (см. ниже) в настройках проекта.
- Vercel может хранить **логи выполнения функций** (в панели Vercel / логах деплоя), где могут присутствовать сообщения об ошибках (но текст заявки в `api/send.ts` напрямую в лог не пишется; при ошибке логируется сама ошибка).

### 6.4. Локальная разработка (компьютер разработчика)
Локальный Express‑сервер (`backend/server.js`) пишет служебные логи в консоль (например факт получения запроса и количество товаров).

---

## 7) Подключения к внешним сервисам (третьи лица)

### 7.1. Telegram
Используется в двух местах:
- **Telegram Web App JS** (на клиенте): `frontend/index.html` подключает скрипт `https://telegram.org/js/telegram-web-app.js`.
  - В текущем коде фронтенда нет логики чтения/отправки Telegram `initData`, но сам факт загрузки скрипта означает сетевой запрос к домену Telegram при открытии приложения.
- **Telegram Bot API** (на сервере): `api/send.ts` и `api/post-channel-message.ts` отправляют запросы на `https://api.telegram.org/...`.

### 7.2. Google Fonts
`frontend/src/index.css` импортирует шрифт Golos Text:
- `https://fonts.googleapis.com/...`
(что, в свою очередь, может тянуть ресурсы с доменов Google Fonts/Static).

### 7.3. Vercel (хостинг)
Vercel:
- хостит фронтенд (статические файлы SPA);
- исполняет serverless‑функции `/api/*`;
- хранит переменные окружения проекта.

---

## 8) Переменные окружения и конфигурация (что куда подключено)

### 8.1. Переменные окружения для `/api/send`
Используются в `api/send.ts`:
- **`TELEGRAM_BOT_TOKEN`**: токен Telegram‑бота (BotFather).
- **`TELEGRAM_CHAT_ID`**: ID чата/группы/пользователя, куда приходят заявки.

### 8.2. Переменные окружения для `/api/post-channel-message`
Используются в `api/post-channel-message.ts`:
- **`TELEGRAM_BOT_TOKEN`**: тот же токен бота.
- **`TELEGRAM_CHANNEL_ID`**: идентификатор канала (например `@travelplusbiz`).
- **`APP_URL`**: URL мини‑приложения (домен Vercel), который откроется как Web App по кнопке.
- **`POST_CHANNEL_SECRET`**: секрет для защиты вызова endpoint (сравнивается с `?key=...`).

### 8.3. Vercel конфигурация
В `vercel.json`:
- **`buildCommand`**: `cd frontend && npm install && npm run build`
- **`outputDirectory`**: `frontend/dist`
- **`rewrites`**: все пути, кроме `/api/*`, переписываются на `/index.html` (SPA‑роутинг).
- **`headers` для `/api/*`**: CORS заголовки `Access-Control-Allow-Origin: *` и т.п.

---

## 9) Контент каталога (откуда берутся товары)

Источник данных каталога сейчас **не серверный**:
- `frontend/src/data/products.ts` содержит массив `categories` и `products` (мок‑данные).
- В карточках используется `price: null` для «цена по запросу».
- Изображения товаров ожидаются в `frontend/public/products/<id>.jpg` (часть файлов — заглушки/в перспективе).

---

## 10) Важные замечания для юридической проверки (что обратить внимание)

### 10.1. Передача персональных данных третьему лицу (Telegram)
Фактически персональные данные из формы заявки (имя/телефон/email/комментарий) **передаются в Telegram** (в чат/группу) через Telegram Bot API.

Это важно отразить:
- в политике конфиденциальности/согласии;
- в перечне третьих лиц/обработчиков (если применимо).

### 10.2. Текущая страница `/privacy`
В `frontend/src/pages/Privacy.tsx` есть фраза, что данные «не передаются третьим лицам», что может расходиться с реальным потоком (передача в Telegram как минимум происходит). Юристам стоит проверить и при необходимости скорректировать формулировки.

### 10.3. Внешние подключения при открытии приложения
Даже без отправки формы браузер/вебвью делает запросы:
- к Telegram (`telegram-web-app.js`),
- к Google Fonts (Golos Text).

---

## 11) Как запустить (для понимания окружений)

### 11.1. Локально (frontend)
В папке `frontend/`:
- `npm install`
- `npm run dev` (Vite)

### 11.2. Локально (backend для формы)
В папке `backend/`:
- `npm install`
- `npm run dev` (поднимает `http://localhost:3001`)

Фронтенд в DEV отправляет заявку на `http://127.0.0.1:3001/api/send`.

### 11.3. Продакшен (Vercel)
- Деплой на Vercel (сборка по `vercel.json`).
- Форма отправляет `POST /api/send` на том же домене Vercel.

---

## 12) Используемые библиотеки (кратко)

### 12.1. Frontend (`frontend/package.json`)
- `react`, `react-dom`
- `react-router-dom`
- `zustand`
- `tailwindcss` (как dev dependency)
- `@vercel/node` (в зависимостях фронта — для окружения Vercel в проекте)

### 12.2. Локальный backend (`backend/package.json`)
- `express`
- `cors`
- `node-fetch`

